<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout1}">

<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>

<th:block layout:fragment="css">
	<style>
			:root {
	--green-color: #98FB98;
}

.newRecipe {
	margin: auto;
	width: 700px;
	border-radius: 5px;
	padding: 20px;
	
}

.in {
	width: 500px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	margin-bottom: 15px;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 15px;
	height: 50px;
	font-size: 14px;
	margin-left: 50px;
	
}

.recipeMain{
	display: flex;
}

.recipe{
	margin-bottom: auto;
	margin-top: auto;
	width:100px;
}

.recipesubMain{
	display: flex;
}

.recipeSubs{
	margin-bottom: auto;
	margin-top: auto;
	width:100px;
}

.recipeSub{
	width: 500px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	margin-bottom: 15px;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 15px;
	height: 50px;
	font-size: 14px;
	margin-left: 50px;
}

.pictureMain{
	display: flex;
}

.picture{
	width:100px;
	margin-bottom: auto;
	margin-top: auto;
}

.categoryMain{
	display: flex;
	margin-bottom: 15px;
}

.category{
	width:100px;
	margin-bottom: auto;
	margin-top: auto;
	margin-right: 50px;
}


h2{
	text-align: left;
	margin: 0 auto;
}

.in3{
	width: 200px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 5px;
	height: 40px;
	font-size: 14px;
	margin-left: 50px;
}

.ingredientsMain{
	display: flex;
}

.ingredients{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
}

.in4{
	width: 200px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 5px;
	height: 40px;
	font-size: 14px;
	margin-left: 25px;
}


.btn{
	width: 65px;
	height: 40px;
		cursor: pointer;
		background-color: white;
		border: 1px solid;
		border-color: #dee2e6;
		border-radius: 5px;
		margin-bottom: 5px;
		font-size: 13px;
		
		
}

.btn:hover{
	background-color: var(--green-color);
	border: 1px solid;
	border-color: #dee2e6;
}

.recipeTurnMain{
display: flex;
height: 70px;
}

.recipeTurns{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
}

.recipeTurn{
	width: 425px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 5px;
	height: 100px;
	font-size: 14px;
	margin-left: 55px;
	resize: none;
	margin-bottom: 5px;
	text-align: left !important;
}

.btn2{
width: 65px;
	height: 55px;
		cursor: pointer;
		background-color: white;
		border: 1px solid;
		border-color: #dee2e6;
		border-radius: 5px;
		font-size: 13px;
		margin-top: auto;
		margin-bottom: auto;
}

.btn2:hover{
	background-color: var(--green-color);
	border: 1px solid;
	border-color: #dee2e6;
}

.btn3{
	width: 65px;
	height: 55px;
		cursor: pointer;
		background-color: white;
		border: 1px solid;
		border-color: #dee2e6;
		border-radius: 5px;
		font-size: 13px;
		position: relative; /* 위치를 상대적으로 설정 */
    	bottom: 50px; /* Y축으로 20px 아래로 이동 */
    	margin-left: 7px;
}

.btn3:hover{
	background-color: var(--green-color);
	border: 1px solid;
	border-color: #dee2e6;
}

.recipePictureMain {
	display: flex;
}

.recipePictures{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
}

.in5{
	width: 150px;
	height: 150px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	margin-bottom: 15px;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 15px;
	font-size: 14px;
	margin-left: 50px;
	display: none;
	
}

.input-file-button{
	width:130px;
	height:130px;
  border-radius: 4px;
  background-color:#dee2e6;
  color: black;
  cursor: pointer;
  margin-left: 50px;
  	margin-top: 10px;

}

.input-file-button:hover{
	border: 1px solid;
	border-color: black;
}

.in10{
	display: flex;
}

.recipeTurns{
	width: 100px;
}

#btnAtt{
	margin-left: 50px;
}

.box3{
	display: flex;
}

.newbtns{
	width: 320px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	margin-bottom: 25px;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 20px;
	height: 50px;
	font-size: 14px;
}

#newbtn1{
	background-color: #1BBC9B;
	margin-bottom: 30px;
	color: white;
	cursor: pointer;
	transition: background-color 0.5s;
	border: none;
}
#newbtn2{
	background-color: #1BBC9B;
	margin-bottom: 30px;
	color: white;
	cursor: pointer;
	transition: background-color 0.5s;
	border: none;
}


#newbtn1:hover{
	background-color: gold;
}

#newbtn2:hover{
	background-color: gold;
}


.recipeTime{
	display: flex;
	margin-bottom: 10px;
}

.recipeTimes{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
	margin-right: 50px;
}

.time{
	margin-right: 30px;
}

.recipeContent{
	display: flex;
}

.recipeContents{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
}

.in6{
	width: 500px;
	padding: 10px;
	box-sizing: border-box;
	border-radius: 5px;
	border: none;
	margin-bottom: 15px;
	border: 1px solid;
	/* border-color: var(--green-color); */
	border-color: #dee2e6;
	margin-top: 15px;
	height: 80px;
	font-size: 14px;
	margin-left: 50px;
	resize: none;
}

.form-select{
	width: 150px; 
	padding: 10px; 
	box-sizing: border-box ;
	border-radius: 5px ;
	border: none ;
	border: 1px solid ;
	/* border-color: var(--green-color); */
	border-color: #dee2e6 ;
	height: 40px ;
	font-size: 14px ;
}
/* 이미지 추가버튼 css  */

#att_zone {
  width: 510px;
  min-height: 150px;
  padding-left:30px;
  border: 1px solid #dee2e6;
  margin-left: 50px;
  border-radius: 5px;
  margin-top: 5px;
  
}

#att_zone:empty:before {
  content: attr(data-placeholder);
  color: #999;
  font-size: .9em;
}

.pictureRecipe{
	display: flex;
	margin-top: 10px;
}

.recipeImg{
	margin-left: 55px;
}

.recipeMain2{
}

.ingredientTextMain{
	display: flex;
	margin-right: 8px;
}
	
.ingredientText{
	margin-bottom: auto;
	margin-top: auto;
	width: 100px;
}

.newbtnMain{
	text-align: center;
}

.ingredientsBtn{
	width: 100px;
}

.ingredientTextBtn{
	width: 100px;
}

.btn4{
	width: 65px;
	height: 55px;
		cursor: pointer;
		background-color: white;
		border: 1px solid;
		border-color: #dee2e6;
		border-radius: 5px;
		font-size: 13px;
		position: relative; /* 위치를 상대적으로 설정 */
    	top: 30px; /* Y축으로 20px 아래로 이동 */
    	margin-left: 7px;
}

.btn4:hover{
	background-color: var(--green-color);
	border: 1px solid;
	border-color: #dee2e6;
}
	</style>
</th:block>

<div layout:fragment="content">
		<div class="newRecipe">
		<h3>레시피 수정</h3>
			<form role="recipeModifyForm"  th:action="@{'/myPage/recipe/modify/' + ${recipeNewDto.id}}" method="post" enctype="multipart/form-data" th:object="${recipeNewDto}" id="recipeForm" >
			<input type="hidden" th:field="*{id}" />
				<div class="recipeMain">
					<label for="recipe" class="recipe">레시피 제목</label>
					<input type="text" placeholder="레시피 제목을 입력해주세요" class="in" th:field="*{title}"> 
				</div>
				<div class="recipesubMain">
					<label for="recipeContent" class="recipeSubs">레시피부제목</label>
					<input type="text" placeholder="레시피 부제목을 입력해주세요" class="recipeSub" th:field="*{subTitle}"> 
				</div>
				<div class="recipesubMain">
					<label th:for="intro" class="recipeSubs">레시피 소개</label>
					<input type="text" placeholder="레시피 소개를 입력해주세요" class="recipeSub" th:field="*{intro}"> 
				</div>
				<div class="pictureMain">
					<label for="picture" class="picture">요리메인사진</label> <!-- //th:src="@{${recipeNewDto.imageUrl}}" -->
					<input type="file" class="in upload-hidden" accept="image/*" name="recipeImgFile"> 
				</div>
				<div class="categoryMain">
					<label th:for="level" class="category">난이도</label>
						<select class="form-select" aria-label="select example" th:field="*{level}">
						   <option value="" disabled selected>난이도 선택</option>
						  <option value="초급">초급</option>
						  <option value="중급">중급</option>
						  <option value="고급">고급</option>
						</select>
				</div>
				<div class="categoryMain">
					<label th:for="categoryEnum" class="category">카테고리</label>
						<select class="form-select" aria-label="select example" th:field="*{categoryEnum}">
						  <option value="" disabled selected>종류별선택</option>
						  <option value="메인요리">메인요리</option>
						  <option value="밑반찬">밑반찬</option>
						  <option value="간식">간식</option>
						  <option value="간단요리">간단요리</option>
						   <option value="초대요리">초대요리</option>
						</select>
				</div>
				<div class="recipeTime">
					<label th:for="category" class="recipeTimes">조리 시간</label>
					<select class="form-select time" aria-label="select example" th:field="*{durTime}">
						  <option value="none" selected>시간</option>
						  <option value="10">~10분</option>
						  <option value="20">10~20분</option>
						  <option value="30">20~30분</option>
						  <option value="40">30~40분</option>
						  <option value="50">40~50분</option>
						  <option value="60">50분+</option>
					</select>
					<label th:for="serving" class="recipeTimes">조리 인분수</label>
					<select class="form-select time" aria-label="select example" th:field="*{serving}">
						   <option value="none"selected>인분</option>
						  <option value="1">1인분</option>
						  <option value="2">2인분</option>
						  <option value="3">3인분</option>
						  <option value="4">4인분</option>
						  <option value="5">5인분</option>
						  <option value="6">5인분이상</option>
					</select>
				</div>
				<div class="ingredientsMain">
					<div class="ingredientsBtn">
						<label for="ingredients" class="ingredients">재료 추가</label>
			            <button class="btn" type="button" onclick="add_textbox()">추가</button>
					</div>
					<div>
						<div id="box"  >
				           	<div th:each="recipeIngre : ${recipeNewDto.recipeIngreDtoList}">
					           	<input type="text" class="in3" placeholder="재료이름"   th:value="${recipeIngre.ingreName}" name="recipeingreName"> 
					            <input type="text" class="in4" placeholder="개수 또는 g(무게)" th:value="${recipeIngre.ingreMaterial}" name="recipeingreMaterial">
					            <button class='btn' type='button' onclick='remove(this)'>삭제</button> 
				           	</div>
				        </div>
			        </div> 
			    </div>   
				<div class="ingredientTextMain">
				    <div class="ingredientTextBtn">
				        <label for="ingredientText" class="ingredientText">조리 설명</label>
				        <button class="btn2" type="button" onclick="add_textareabox()">추가</button>
				    </div>
				    <div id="box2">
				        <div th:each="recipeOrder : ${recipeNewDto.recipeOrderDtoList}">
				            <div class="recipeOrder">
				                <input type="file" class="recipeImg" name="recipeOrderImgFile" accept="image/*">
				                <div class="box3">
				                    <textarea class="recipeTurn" name="recipeOrderContent" placeholder="요리순서를 입력해주세요" th:text="${recipeOrder.content}"></textarea>
				                    <button class='btn4' type='button' onclick='removeElement2(this)'>삭제</button>
				                </div>
				            </div>
				        </div>
				    </div>
				</div>
				<div class="newbtnMain">
					<button type="submit" name="writingStatus" id="newbtn1" class="newbtns" value="PUBLISHED" onclick="return confirmPublish()">수정</button>
					<button type="submit"  name="writingStatus" id="newbtn2" class="newbtns" value="DRAFT" onclick="return confirmDraft()">임시저장</button>
				</div>
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			</form>
		</div>
</div>

<th:block layout:fragment="script">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:inline="javascript">
	//에러메세지
	var errorMessage = [[${errorMessage}]];
	if(errorMessage != null){
    	alert(errorMessage);
	} 
	
	//레시피수정확인
	function confirmPublish() {
		//모든값이 입력되었는지 확인
		var form = document.getElementById('recipeForm');
		var elements = form.querySelectorAll('input:not([type="hidden"]), textarea, select');
		console.log(elements)
	    for (var i = 0; i < elements.length; i++) {
	    	 console.log(`Element ${i + 1}: ${elements[i].name}, Value: ${elements[i].value}`);
	        if (elements[i].value === "") {  
	            alert('모든 내용을 입력해주세요.');
	            return false;  
	        }
	    }

	    return confirm("레시피를 정말로 등록하시겠습니까?");
	}

	
	//임시저장 함수
	function confirmDraft() {
	    return confirm("레시피를 임시저장 하시겠습니까?");
	}
	$(document).ready(function(){
		bindDomEvent();
		bindDomEvent2();
	});
	
	//이미지 확인
	function bindDomEvent(){
        $(".recipeImg").on("change", function() {
            var fileName = $(this).val().split("\\").pop();  //이미지 파일명
            var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
            fileExt = fileExt.toLowerCase(); //소문자 변환

            if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
                alert("이미지 파일만 등록이 가능합니다.");
                return;
            }

            $(this).siblings(".recipeImg").html(fileName);
        });
    }
	//이미지 확인
	function bindDomEvent2(){
        $(".upload-hidden").on("change", function() {
            var fileName = $(this).val().split("\\").pop();  //이미지 파일명
            var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
            fileExt = fileExt.toLowerCase(); //소문자 변환

            if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
                alert("이미지 파일만 등록이 가능합니다.");
                return;
            }

            $(this).siblings(".upload-hidden").html(fileName);
        });
    }
	
	
	//재료칸 추가 js
	
	const add_textbox = () => {
	    const box = document.getElementById("box");
	    const newP = document.createElement('div');
	
	    newP.innerHTML = 
	    	"<input class='in3' type='text' id='RecipeingreName' name='RecipeingreName'> " +
	    	"<input class='in4' type='text' id='RecipeingreMaterial' name='RecipeingreMaterial'> " +
	    	"<button class='btn' type='button' onclick='remove(this)'>삭제</button>";
	    box.appendChild(newP);
	}
	
	// 재료추가삭제
	const remove = (obj) => {
	    const box = document.getElementById('box');
	    
	    // 최소재료1개유지
	    if (box.children.length > 1) {
	        box.removeChild(obj.parentNode);
	    } else {
	        alert("최소 1개의 재료는 있어야 합니다.");
	    }
	}
	
	// 새로운 조리 설명 추가 js
    const add_textareabox = () => {
        const box2 = document.getElementById("box2");
        const newDiv = document.createElement('div');
        
        newDiv.innerHTML =
            "<div class='recipeOrder'>" +
            "<input type='file' class='recipeImg' name='recipeOrderImgFile' accept='image/*'>" +
            "<div class='box3'>" +
            "<textarea class='recipeTurn' name='recipeOrderContent' placeholder='요리순서를 입력해주세요'></textarea>" +
            "<button class='btn4' type='button' onclick='removeElement2(this)'>삭제</button>" +
            "</div>" +
            "</div>";
        box2.appendChild(newDiv);
    }

    // 조리 설명 삭제
    const removeElement2 = (button) => {
    	const removeDiv = button.closest('.recipeOrder');
        const recipeOrders = document.querySelectorAll('.recipeOrder');
        
        //최소1개
        if (removeDiv && recipeOrders.length > 1) {
            removeDiv.remove();
        } else {
            alert("최소 1개의 조리 설명이 있어야 합니다.");
        }
    }
	</script>
</th:block>

</html>